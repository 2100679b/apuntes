<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Apuntes Escolares - Ingeniería</title>
    
    <!-- React y ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel para traducir JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Personalización de scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 font-sans overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Componentes de Iconos ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            GraduationCap: (props) => <Icon {...props} path={<><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />,
            Calendar: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>} />,
            Search: (props) => <Icon {...props} path={<><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></>} />,
            Folder: (props) => <Icon {...props} path={<><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            FileText: (props) => <Icon {...props} path={<><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></>} />,
            Menu: (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></>} />,
            Book: (props) => <Icon {...props} path={<><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></>} />,
            Edit3: (props) => <Icon {...props} path={<><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></>} />,
            Upload: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></>} />,
            ExternalLink: (props) => <Icon {...props} path={<><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />,
        };

        // --- Datos y Constantes ---
        const SUBJECT_COLORS = [
            { name: 'Azul', bg: 'bg-blue-100', text: 'text-blue-700', border: 'border-blue-200' },
            { name: 'Verde', bg: 'bg-emerald-100', text: 'text-emerald-700', border: 'border-emerald-200' },
            { name: 'Naranja', bg: 'bg-orange-100', text: 'text-orange-700', border: 'border-orange-200' },
            { name: 'Morado', bg: 'bg-purple-100', text: 'text-purple-700', border: 'border-purple-200' },
            { name: 'Rosa', bg: 'bg-pink-100', text: 'text-pink-700', border: 'border-pink-200' },
            { name: 'Gris', bg: 'bg-gray-100', text: 'text-gray-700', border: 'border-gray-200' },
            { name: 'Indigo', bg: 'bg-indigo-100', text: 'text-indigo-700', border: 'border-indigo-200' },
            { name: 'Teal', bg: 'bg-teal-100', text: 'text-teal-700', border: 'border-teal-200' },
        ];

        const SEMESTERS = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX', 'X'];

        const INITIAL_CURRICULUM = [
            // Semestre I
            { name: 'Álgebra Superior', semester: 'I' }, { name: 'Cálculo I', semester: 'I' }, { name: 'Física I', semester: 'I' }, { name: 'Técnicas de Estudio', semester: 'I' }, { name: 'Química', semester: 'I' }, { name: 'Inglés I', semester: 'I' }, { name: 'Lab. Física I', semester: 'I' }, { name: 'Lab. Herramientas Computacionales', semester: 'I' }, { name: 'Lab. Química', semester: 'I' },
            // Semestre II
            { name: 'Cálculo II', semester: 'II' }, { name: 'Física II', semester: 'II' }, { name: 'Programación de Computadoras', semester: 'II' }, { name: 'Electrónica Analógica I', semester: 'II' }, { name: 'Lógica', semester: 'II' }, { name: 'Inglés II', semester: 'II' }, { name: 'Lab. Física II', semester: 'II' }, { name: 'Lab. Programación de Computadoras', semester: 'II' }, { name: 'Lab. Electrónica Analógica I', semester: 'II' },
            // Semestre III
            { name: 'Cálculo III', semester: 'III' }, { name: 'Teoría Electromagnética I', semester: 'III' }, { name: 'Métodos Numéricos', semester: 'III' }, { name: 'Electrónica Analógica II', semester: 'III' }, { name: 'Termodinámica', semester: 'III' }, { name: 'Inglés III', semester: 'III' }, { name: 'Lab. Teoría Electromagnética I', semester: 'III' }, { name: 'Lab. Electrónica Analógica II', semester: 'III' }, { name: 'Lab. Termodinámica', semester: 'III' },
            // Semestre IV
            { name: 'Cálculo IV', semester: 'IV' }, { name: 'Circuitos Eléctricos I', semester: 'IV' }, { name: 'Matemáticas Discretas', semester: 'IV' }, { name: 'Electrónica Digital I', semester: 'IV' }, { name: 'Estructuras de Datos', semester: 'IV' }, { name: 'Ingeniería de Programación', semester: 'IV' }, { name: 'Inglés IV', semester: 'IV' }, { name: 'Lab. Electrónica Digital I', semester: 'IV' },
            // Semestre V
            { name: 'Álgebra Lineal', semester: 'V' }, { name: 'Análisis de Algoritmos', semester: 'V' }, { name: 'Paradigmas de Programación', semester: 'V' }, { name: 'Probabilidad y Estadística', semester: 'V' }, { name: 'Control Analógico I', semester: 'V' }, { name: 'Lenguajes Formales y Autómatas', semester: 'V' }, { name: 'Lab. Paradigmas de Programación', semester: 'V' }, { name: 'Lab. Control Analógico I', semester: 'V' },
            // Semestre VI
            { name: 'Graficación', semester: 'VI' }, { name: 'Organización de Computadoras', semester: 'VI' }, { name: 'Compiladores', semester: 'VI' }, { name: 'Control Analógico II', semester: 'VI' }, { name: 'Comunicaciones I', semester: 'VI' }, { name: 'Economía', semester: 'VI' }, { name: 'Lab. Control Analógico II', semester: 'VI' }, { name: 'Lab. Comunicaciones', semester: 'VI' }, { name: 'Lab. Graficación', semester: 'VI' },
            // Semestre VII
            { name: 'Teoría de la Computación', semester: 'VII' }, { name: 'Investigación de Operaciones', semester: 'VII' }, { name: 'Bases de Datos', semester: 'VII' }, { name: 'Redes de Computadoras', semester: 'VII' }, { name: 'Tema Selecto Sem VII', semester: 'VII' }, { name: 'Lab. Redes de Computadoras', semester: 'VII' }, { name: 'Lab. Bases de Datos', semester: 'VII' },
            // Semestre VIII
            { name: 'Modelos Probabilistas', semester: 'VIII' }, { name: 'Control Digital I', semester: 'VIII' }, { name: 'Sistemas Operativos', semester: 'VIII' }, { name: 'Administración', semester: 'VIII' }, { name: 'Ética Profesional', semester: 'VIII' }, { name: 'Tema Selecto Sem VIII', semester: 'VIII' }, { name: 'Lab. Control Digital I', semester: 'VIII' }, { name: 'Lab. Sistemas Operativos', semester: 'VIII' }, { name: 'Lab. Tema Selecto', semester: 'VIII' },
            // Semestre IX
            { name: 'Expresión Oral y Escrita', semester: 'IX' }, { name: 'Contabilidad', semester: 'IX' }, { name: 'Tema Selecto 1 Sem IX', semester: 'IX' }, { name: 'Tema Selecto 2 Sem IX', semester: 'IX' }, { name: 'Tema Selecto 3 Sem IX', semester: 'IX' }, { name: 'Lab. Tema Selecto', semester: 'IX' }, { name: 'Inteligencia Artificial', semester: 'IX' }, { name: 'Lab. Inteligencia Artificial', semester: 'IX' },
            // Semestre X
            { name: 'Seminario de Tesis', semester: 'X' },
        ];

        // --- Aplicación Principal ---
        function App() {
            // Estados
            const [subjects, setSubjects] = useState([]);
            const [notes, setNotes] = useState([]);
            const [currentSemester, setCurrentSemester] = useState('I');
            const [selectedSubjectId, setSelectedSubjectId] = useState('all');
            const [selectedNoteId, setSelectedNoteId] = useState(null);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [isEditing, setIsEditing] = useState(false);
            
            const [showSubjectModal, setShowSubjectModal] = useState(false);
            const [newSubjectName, setNewSubjectName] = useState('');
            const [newSubjectColor, setNewSubjectColor] = useState(0);

            // Carga Inicial
            useEffect(() => {
                // CAMBIO: Nuevas keys v4 para asegurar limpieza
                const savedSubjects = localStorage.getItem('study_subjects_v4');
                const savedNotes = localStorage.getItem('study_notes_v4');

                if (savedSubjects) {
                    setSubjects(JSON.parse(savedSubjects));
                } else {
                    const initialSubjects = INITIAL_CURRICULUM.map((sub, index) => ({
                        id: `sub-${index}`,
                        name: sub.name,
                        semester: sub.semester,
                        colorIndex: index % SUBJECT_COLORS.length 
                    }));
                    setSubjects(initialSubjects);
                    localStorage.setItem('study_subjects_v4', JSON.stringify(initialSubjects));
                }

                if (savedNotes) {
                    setNotes(JSON.parse(savedNotes));
                } else {
                    // CAMBIO: Iniciamos con arreglo vacío, sin ejemplos.
                    setNotes([]);
                    localStorage.setItem('study_notes_v4', JSON.stringify([]));
                }
            }, []);

            // Persistencia
            useEffect(() => {
                if (subjects.length > 0) localStorage.setItem('study_subjects_v4', JSON.stringify(subjects));
                // Guardamos incluso si está vacío para mantener el estado
                localStorage.setItem('study_notes_v4', JSON.stringify(notes));
            }, [subjects, notes]);

            // Handlers
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (file.type !== 'application/pdf') {
                    alert('Por favor selecciona solo archivos PDF.');
                    return;
                }
                if (file.size > 5000000) { 
                    alert('El archivo es demasiado grande (>5MB). Usa una URL o un archivo más pequeño.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    updateNote('pdfData', event.target.result);
                    updateNote('sourceType', 'file');
                    if (getNote().title === 'Nuevo Documento') {
                        updateNote('title', file.name);
                    }
                };
                reader.readAsDataURL(file);
            };

            const handleAddSubject = () => {
                if (!newSubjectName.trim()) return;
                const newSubject = {
                    id: Date.now().toString(),
                    name: newSubjectName,
                    semester: currentSemester,
                    colorIndex: newSubjectColor
                };
                setSubjects([...subjects, newSubject]);
                setNewSubjectName('');
                setShowSubjectModal(false);
            };

            const handleAddNote = () => {
                let targetSubjectId = selectedSubjectId;
                if (targetSubjectId === 'all') {
                    const visibleSubjects = subjects.filter(s => s.semester === currentSemester);
                    targetSubjectId = visibleSubjects.length > 0 ? visibleSubjects[0].id : (subjects[0]?.id || '');
                }

                const newNote = {
                    id: Date.now().toString(),
                    subjectId: targetSubjectId,
                    title: 'Nuevo Documento',
                    pdfData: '', 
                    sourceType: 'url',
                    date: new Date().toISOString()
                };
                setNotes([newNote, ...notes]);
                setSelectedNoteId(newNote.id);
                setIsEditing(true);
                if (window.innerWidth < 768) setIsSidebarOpen(false);
            };

            const updateNote = (field, value) => {
                setNotes(notes.map(note => 
                    note.id === selectedNoteId ? { ...note, [field]: value, date: new Date().toISOString() } : note
                ));
            };

            const handleDeleteNote = (e, id) => {
                e.stopPropagation();
                if (confirm('¿Eliminar este documento?')) {
                    setNotes(notes.filter(n => n.id !== id));
                    if (selectedNoteId === id) setSelectedNoteId(null);
                }
            };

            const getSubject = (id) => subjects.find(s => s.id === id);
            const getNote = () => notes.find(n => n.id === selectedNoteId);

            const visibleSubjects = subjects.filter(subject => subject.semester === currentSemester);
            const filteredNotes = notes.filter(note => {
                const noteSubject = getSubject(note.subjectId);
                if (!noteSubject) return false;
                if (noteSubject.semester !== currentSemester) return false;
                const matchesSubject = selectedSubjectId === 'all' || note.subjectId === selectedSubjectId;
                const matchesSearch = note.title.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesSubject && matchesSearch;
            });

            const activeNoteData = getNote();
            const activeSubjectData = activeNoteData ? getSubject(activeNoteData.subjectId) : null;
            const activeColor = activeSubjectData ? SUBJECT_COLORS[activeSubjectData.colorIndex] : SUBJECT_COLORS[5];

            // Renderizado
            return (
                <div className="flex h-screen bg-gray-50 text-slate-800 font-sans overflow-hidden">
                    
                    {/* Sidebar */}
                    <aside className={`fixed inset-y-0 left-0 z-30 w-80 bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 flex flex-col`}>
                        <div className="p-4 border-b border-gray-100">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center space-x-2 text-indigo-600 font-bold text-lg">
                                    <Icons.GraduationCap className="w-6 h-6" />
                                    <span>Ing. Computación</span>
                                </div>
                                <button onClick={() => setIsSidebarOpen(false)} className="md:hidden p-1 rounded hover:bg-gray-100">
                                    <Icons.X className="w-5 h-5 text-gray-500" />
                                </button>
                            </div>

                            <div className="flex items-center space-x-2 bg-indigo-50 p-2 rounded-lg">
                                <Icons.Calendar className="w-4 h-4 text-indigo-600" />
                                <span className="text-xs font-semibold text-indigo-700 uppercase">Semestre:</span>
                                <select 
                                    value={currentSemester}
                                    onChange={(e) => {
                                        setCurrentSemester(e.target.value);
                                        setSelectedSubjectId('all');
                                    }}
                                    className="bg-transparent text-sm font-bold text-indigo-900 focus:outline-none cursor-pointer w-full"
                                >
                                    {SEMESTERS.map(sem => (
                                        <option key={sem} value={sem}>{sem}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <div className="px-4 py-2">
                            <div className="relative">
                                <span className="absolute left-3 top-2.5 w-4 h-4 text-gray-400"><Icons.Search className="w-4 h-4" /></span>
                                <input 
                                    type="text" 
                                    placeholder="Buscar PDF..." 
                                    className="w-full pl-9 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto px-4 pb-2">
                            <div className="sticky top-0 bg-white z-10 py-2">
                                <h3 className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Materias (Sem. {currentSemester})</h3>
                            </div>
                            
                            <div className="space-y-1 mb-6">
                                <button 
                                    onClick={() => setSelectedSubjectId('all')}
                                    className={`w-full flex items-center space-x-2 px-3 py-2 rounded-lg text-sm transition-colors ${selectedSubjectId === 'all' ? 'bg-indigo-50 text-indigo-700 font-medium' : 'text-gray-600 hover:bg-gray-50'}`}
                                >
                                    <Icons.Folder className="w-4 h-4" />
                                    <span>Ver Todos los PDFs</span>
                                </button>
                                
                                {visibleSubjects.map(subject => (
                                    <button 
                                        key={subject.id}
                                        onClick={() => setSelectedSubjectId(subject.id)}
                                        className={`w-full text-left flex items-center justify-between px-3 py-1.5 rounded-lg text-sm transition-colors ${selectedSubjectId === subject.id ? 'bg-gray-100 text-gray-900 font-medium' : 'text-gray-600 hover:bg-gray-50'}`}
                                    >
                                        <div className="flex items-center space-x-2 truncate">
                                            <div className={`flex-shrink-0 w-2 h-2 rounded-full ${SUBJECT_COLORS[subject.colorIndex].bg.replace('bg-', 'bg-').replace('100', '500')}`}></div>
                                            <span className="truncate">{subject.name}</span>
                                        </div>
                                    </button>
                                ))}

                                <button onClick={() => setShowSubjectModal(true)} className="w-full flex items-center space-x-2 px-3 py-2 mt-2 rounded-lg text-sm text-gray-400 hover:text-indigo-600 hover:bg-gray-50 transition-colors dashed border border-transparent hover:border-indigo-200">
                                    <Icons.Plus className="w-3 h-3" />
                                    <span>Añadir Materia</span>
                                </button>
                            </div>

                            <div className="border-t border-gray-100 pt-4">
                                <div className="flex items-center justify-between mb-2">
                                    <h3 className="text-xs font-semibold text-gray-400 uppercase tracking-wider">Documentos</h3>
                                    <button onClick={handleAddNote} className="p-1 hover:bg-indigo-50 text-indigo-600 rounded" title="Subir PDF">
                                        <Icons.Plus className="w-4 h-4" />
                                    </button>
                                </div>
                                
                                <div className="space-y-2 pb-10">
                                    {filteredNotes.length === 0 ? (
                                        <div className="text-center py-6 text-gray-400 text-xs">
                                            {subjects.length > 0 ? 'No hay documentos guardados.' : 'Carga materias primero.'}
                                        </div>
                                    ) : (
                                        filteredNotes.map(note => {
                                            const subject = getSubject(note.subjectId);
                                            const color = subject ? SUBJECT_COLORS[subject.colorIndex] : SUBJECT_COLORS[5];
                                            
                                            return (
                                                <div 
                                                    key={note.id}
                                                    onClick={() => {
                                                        setSelectedNoteId(note.id);
                                                        setIsEditing(false);
                                                        if (window.innerWidth < 768) setIsSidebarOpen(false);
                                                    }}
                                                    className={`group relative p-3 rounded-xl border transition-all cursor-pointer ${selectedNoteId === note.id ? 'bg-white border-indigo-300 shadow-md ring-1 ring-indigo-100' : 'bg-white border-gray-100 hover:border-gray-300 hover:shadow-sm'}`}
                                                >
                                                    <div className="flex justify-between items-start mb-1">
                                                        <span className={`text-[10px] px-2 py-0.5 rounded-full font-medium truncate max-w-[70%] ${color.bg} ${color.text}`}>
                                                            {subject ? subject.name : 'Sin materia'}
                                                        </span>
                                                        <button onClick={(e) => handleDeleteNote(e, note.id)} className="opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-red-500">
                                                            <Icons.Trash2 className="w-3.5 h-3.5" />
                                                        </button>
                                                    </div>
                                                    <div className="flex items-center space-x-2 mt-2">
                                                        <Icons.FileText className="w-4 h-4 text-red-500 flex-shrink-0" />
                                                        <h4 className="text-sm font-semibold text-gray-800 line-clamp-2">{note.title}</h4>
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* Área Principal */}
                    <main className="flex-1 flex flex-col h-full overflow-hidden bg-white relative">
                        {!isSidebarOpen && (
                            <button 
                                onClick={() => setIsSidebarOpen(true)}
                                className="md:hidden absolute top-4 left-4 z-20 p-2 bg-white rounded-full shadow-lg border border-gray-200"
                            >
                                <Icons.Menu className="w-5 h-5 text-gray-600" />
                            </button>
                        )}

                        {selectedNoteId ? (
                            <>
                                <div className="h-16 border-b border-gray-100 flex items-center justify-between px-6 md:px-10 flex-shrink-0">
                                    <div className="flex items-center space-x-4 pl-8 md:pl-0 truncate">
                                        <span className={`text-xs px-2 py-1 rounded-md font-medium border flex-shrink-0 ${activeColor.bg} ${activeColor.text} ${activeColor.border}`}>
                                            {activeSubjectData?.name || 'General'}
                                        </span>
                                        <span className="text-sm font-bold text-gray-700 truncate">{activeNoteData.title}</span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2">
                                        <button 
                                            onClick={() => setIsEditing(!isEditing)}
                                            className={`flex items-center space-x-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${isEditing ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-100'}`}
                                        >
                                            {isEditing ? (
                                                <>
                                                    <Icons.Book className="w-4 h-4" />
                                                    <span>Ver PDF</span>
                                                </>
                                            ) : (
                                                <>
                                                    <Icons.Edit3 className="w-4 h-4" />
                                                    <span>Editar Info</span>
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>

                                <div className="flex-1 bg-gray-100 relative">
                                    {isEditing ? (
                                        <div className="absolute inset-0 overflow-y-auto">
                                            <div className="max-w-xl mx-auto px-6 py-12">
                                                <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200 space-y-6">
                                                    <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                                        <Icons.Edit3 className="w-5 h-5" />
                                                        Editar Documento
                                                    </h2>

                                                    <div>
                                                        <label className="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Asignatura</label>
                                                        <select 
                                                            value={activeNoteData.subjectId} 
                                                            onChange={(e) => updateNote('subjectId', e.target.value)}
                                                            className="w-full p-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                                        >
                                                            {subjects.map(s => <option key={s.id} value={s.id}>{s.semester} - {s.name}</option>)}
                                                        </select>
                                                    </div>

                                                    <div>
                                                        <label className="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Título del Documento</label>
                                                        <input 
                                                            type="text" 
                                                            value={activeNoteData.title}
                                                            onChange={(e) => updateNote('title', e.target.value)}
                                                            placeholder="Ej. Apuntes Unidad 1"
                                                            className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-base focus:ring-2 focus:ring-indigo-500 outline-none"
                                                        />
                                                    </div>
                                                    
                                                    <div className="pt-4 border-t border-gray-100">
                                                        <label className="block text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Fuente del PDF</label>
                                                        
                                                        <div className="space-y-4">
                                                            <div className={`p-4 border-2 border-dashed rounded-xl transition-colors ${activeNoteData.sourceType === 'file' ? 'border-indigo-400 bg-indigo-50/50' : 'border-gray-200 hover:border-gray-300'}`}>
                                                                <div className="flex items-center gap-3 mb-2">
                                                                    <input 
                                                                        type="radio" 
                                                                        id="sourceFile" 
                                                                        checked={activeNoteData.sourceType === 'file'} 
                                                                        onChange={() => updateNote('sourceType', 'file')}
                                                                        className="text-indigo-600"
                                                                    />
                                                                    <label htmlFor="sourceFile" className="font-medium text-gray-700 cursor-pointer flex items-center gap-2">
                                                                        <Icons.Upload className="w-4 h-4" /> Subir Archivo
                                                                    </label>
                                                                </div>
                                                                
                                                                {activeNoteData.sourceType === 'file' && (
                                                                    <div className="ml-7 mt-2">
                                                                        <input 
                                                                            type="file" 
                                                                            accept="application/pdf"
                                                                            onChange={handleFileUpload}
                                                                            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                                                                        />
                                                                        <p className="text-xs text-gray-400 mt-2 flex items-center gap-1">
                                                                            <Icons.AlertCircle className="w-3 h-3" /> Máx 5MB. Se guarda en el navegador.
                                                                        </p>
                                                                    </div>
                                                                )}
                                                            </div>

                                                            <div className={`p-4 border-2 border-dashed rounded-xl transition-colors ${activeNoteData.sourceType === 'url' ? 'border-indigo-400 bg-indigo-50/50' : 'border-gray-200 hover:border-gray-300'}`}>
                                                                <div className="flex items-center gap-3 mb-2">
                                                                    <input 
                                                                        type="radio" 
                                                                        id="sourceUrl" 
                                                                        checked={activeNoteData.sourceType === 'url'} 
                                                                        onChange={() => updateNote('sourceType', 'url')}
                                                                        className="text-indigo-600"
                                                                    />
                                                                    <label htmlFor="sourceUrl" className="font-medium text-gray-700 cursor-pointer flex items-center gap-2">
                                                                        <Icons.ExternalLink className="w-4 h-4" /> Enlace URL
                                                                    </label>
                                                                </div>

                                                                {activeNoteData.sourceType === 'url' && (
                                                                    <div className="ml-7 mt-2">
                                                                        <input 
                                                                            type="text" 
                                                                            value={activeNoteData.sourceType === 'url' ? activeNoteData.pdfData : ''}
                                                                            onChange={(e) => {
                                                                                updateNote('sourceType', 'url');
                                                                                updateNote('pdfData', e.target.value);
                                                                            }}
                                                                            placeholder="https://ejemplo.com/archivo.pdf"
                                                                            className="w-full p-2 bg-white border border-gray-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
                                                                        />
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <button onClick={() => setIsEditing(false)} className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors">
                                                        Guardar y Visualizar
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="w-full h-full flex flex-col">
                                            {activeNoteData.pdfData ? (
                                                <iframe 
                                                    src={activeNoteData.pdfData} 
                                                    className="w-full h-full border-none"
                                                    title="Visor PDF"
                                                />
                                            ) : (
                                                <div className="flex-1 flex flex-col items-center justify-center text-gray-400">
                                                    <Icons.FileText className="w-16 h-16 mb-4 text-gray-300" />
                                                    <p>No hay PDF cargado.</p>
                                                    <button onClick={() => setIsEditing(true)} className="mt-4 text-indigo-600 hover:underline">
                                                        Subir PDF o agregar enlace
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center p-8 text-center bg-gray-50/50">
                                <div className="w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center mb-6">
                                    <Icons.GraduationCap className="w-10 h-10 text-indigo-400" />
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900 mb-2">Tus Apuntes Personales</h2>
                                <p className="text-gray-500 max-w-md mb-8">
                                    Este espacio está vacío. Sube tus propios archivos PDF para empezar a organizar tu semestre.
                                </p>
                                <button onClick={handleAddNote} className="flex items-center space-x-2 px-6 py-3 bg-indigo-600 text-white rounded-xl shadow-lg hover:bg-indigo-700 transition-all">
                                    <Icons.Plus className="w-5 h-5" />
                                    <span>Subir Nuevo PDF</span>
                                </button>
                            </div>
                        )}
                    </main>

                    {/* Modal Nueva Materia */}
                    {showSubjectModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden animate-in zoom-in-95 duration-200">
                                <div className="p-6">
                                    <h3 className="text-lg font-bold text-gray-900 mb-4">Añadir Materia al Semestre {currentSemester}</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                                            <input 
                                                type="text" 
                                                value={newSubjectName}
                                                onChange={(e) => setNewSubjectName(e.target.value)}
                                                placeholder="Nombre de la materia"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none"
                                                autoFocus
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Color</label>
                                            <div className="flex space-x-2 flex-wrap gap-2">
                                                {SUBJECT_COLORS.map((color, index) => (
                                                    <button
                                                        key={index}
                                                        onClick={() => setNewSubjectColor(index)}
                                                        className={`w-8 h-8 rounded-full ${color.bg} border-2 transition-all ${newSubjectColor === index ? 'border-gray-600 scale-110' : 'border-transparent hover:scale-105'}`}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex justify-end space-x-3 mt-6">
                                        <button onClick={() => setShowSubjectModal(false)} className="px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg">Cancelar</button>
                                        <button onClick={handleAddSubject} disabled={!newSubjectName.trim()} className="px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg disabled:opacity-50">Guardar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>